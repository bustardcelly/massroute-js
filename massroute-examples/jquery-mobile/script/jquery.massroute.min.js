(function(e){e.massroute=e.massroute||{};e.extend(e.massroute,{getRoutes:function(n){f(c,n)},getConfig:function(n,o){f(l,n,o)},getStops:function(p,o){var n=(i===undefined)?undefined:i.findDestinationByTag(p);if(n===undefined){o.fault("Could not find stops for destination "+p)}else{o.result(i.stopsForDestination(n))}},getPredictions:function(o,n){if(m===undefined){n.fault("Could not load predictions for: "+o)}f(a,o,n)},getRouteById:function(p){if(k===undefined||k.length===0){return undefined}var o,n;o=k.length;while(--o>-1){n=k[o];if(n.tag===p){break}else{n=undefined}}return n},getDestinationById:function(n){if(i===undefined){return null}return i.findDestinationByTag(n)},getStopById:function(n){if(i===undefined){return null}return i.findStopByTag(n)}});var m,k,i;function c(n){e.get("http://webservices.nextbus.com/service/publicXMLFeed?command=routeList&a=mbta").done(function(o){k=[];e(o).find("route").each(function(){k.push(new Route().inflate(this))});n.result(k)}).fail(n.fault)}function l(n,o){m=n;e.get("http://webservices.nextbus.com/service/publicXMLFeed?command=routeConfig&a=mbta&r="+n).done(function(p){if(i===undefined){i=new RouteConfiguration()}i.inflate(p);o.result(i)}).fail(o.fault)}function a(o,n){e.get("http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=mbta&r="+m+"&s="+o).done(function(p){var q=[];e(p).find("prediction").each(function(){q.push(new StopPrediction().inflate(this))});n.result(q)}).fail(n.fault)}var j,d,b,h=10000;function g(){if(j.length>0){d=true;var n=j.shift();n.methodName.apply(this,n.args);b=setInterval(g,h)}else{d=false;clearTimeout(b)}}function f(n){var o,p,q;o=[];q=arguments.length;for(p=1;p<q;p++){o[o.length]=arguments[p]}if(j===undefined){j=[]}j.push({methodName:n,args:o});if(!d){clearTimeout(b);g()}}})(jQuery);