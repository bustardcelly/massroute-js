(function(c){function f(h,g){this.page=undefined;this.service=undefined;if(arguments.length){this._init(h,g)}}f.prototype={_create:function(){},_show:function(){},_hide:function(){},_init:function(h,g){this.page=$(h);this.service=g;var i=this;this.page.bind("pagecreate",function(j,k){i._create()});this.page.bind("pageshow",function(j,k){i._show()});this.page.bind("pagehide",function(j,k){i._hide()})}};function b(i,h){var j=this;this.handleRouteListResult=function(k){var l,m;l=$("#routes");m=l.parent();l.detach();$(k).each(function(){$("#routeItemRenderer").tmpl(this).appendTo(l).bind("click",g).data("route",this.tag).buttonMarkup({wrapperEls:"div",shadow:false,corners:false,iconpos:"right",icon:"arrow-r",theme:"c"}).find('div[class="ui-btn-inner"]').addClass("ui-li")});m.append(l);l.listview("refresh");$.fixedToolbars.show(true);$.mobile.pageLoading(true)};this.handleRouteListFault=function(k){$.mobile.pageLoading(true)};function g(k){k.preventDefault();var l=$(this).data("route");$("#destination").data("route",l);$.mobile.changePage("#destination");return false}j._init(i,h)}b.prototype=new f();b.prototype._create=function(){$.mobile.pageLoading();this.service.getRoutes({result:this.handleRouteListResult,fault:this.handleRouteListFault})};function e(i,g){var l;var j=this;this.showInbound=function(){$("#inboundButton").addClass("ui-btn-active");$("#outboundButton").removeClass("ui-btn-active");h("inbound")};this.showOutbound=function(){$("#inboundButton").removeClass("ui-btn-active");$("#outboundButton").addClass("ui-btn-active");h("outbound")};this.handleConfigurationResult=function(m){l=m;j.showInbound();$.mobile.pageLoading(true)};this.handleConfigurationFault=function(m){$.mobile.pageLoading(true)};this.emptyList=function(){j.page.find("ul[data-role='listview'] li[data-destination!='*']").each(function(m,n){$(this).unbind("click",k)});$("#destinations").empty()};function h(p){var n,m;n=j.service.getRouteById(j.page.data("route"));if(n){var o=j.page.find("div[data-role='content'] p#titlefield");$(o).html("Select an "+p+" destination along Route "+n.title+":")}m=l.getDestinationsByType(p);j.emptyList();$.each(m,function(q,r){$("#titleItemRenderer").tmpl(this).appendTo($("#destinations")).bind("click",k).data("destination",this.tag).buttonMarkup({wrapperEls:"div",shadow:false,corners:false,iconpos:"right",icon:"arrow-r",theme:"c"}).find('div[class="ui-btn-inner"]').addClass("ui-li");$("#destinations").listview("refresh");$.fixedToolbars.show(true)})}function k(m){m.preventDefault();var n=$(this).data("destination");$("#stop").data("destination",n);$.mobile.changePage("#stop");return false}j._init(i,g)}e.prototype=new f();e.prototype._create=function(){$("#inboundButton").bind("click",this.showInbound);$("#outboundButton").bind("click",this.showOutbound)};e.prototype._show=function(){var g=this.page.data("route");if(g){$.mobile.pageLoading();this.service.getConfig(g,{result:this.handleConfigurationResult,fault:this.handleConfigurationFault})}else{$.mobile.changePage("#home")}};e.prototype._hide=function(){this.emptyList();var g=this.page.find("div[data-role='content'] p#titlefield");$(g).html("")};function a(i,g){var j=this;this.handleStopsResult=function(k){var l,m;l=$("#stops");m=l.parent();l.detach();$(k).each(function(){$("#titleItemRenderer").tmpl(this).appendTo(l).bind("click",h).data("stop",this.tag).buttonMarkup({wrapperEls:"div",shadow:false,corners:false,iconpos:"right",icon:"arrow-r",theme:"c"}).find('div[class="ui-btn-inner"]').addClass("ui-li")});m.append(l);l.listview("refresh");$.fixedToolbars.show(true);$.mobile.pageLoading(true)};this.handleStopsFault=function(k){$.mobile.pageLoading(true)};this.emptyList=function(){if(this.listQueue!==undefined){this.listQueue.stop(true)}j.page.find("ul[data-role='listview'] li[data-stop!='*']").each(function(k,l){$(this).unbind("click",h)});$("#stops").empty()};function h(k){k.preventDefault();var l=$(this).data("stop");$("#prediction").data("stop",l);$.mobile.changePage("#prediction");return false}j._init(i,g)}a.prototype=new f();a.prototype._show=function(){var i=this.page.data("destination");if(i){$.mobile.pageLoading();var g=this.service.getDestinationById(i);var h=this.page.find("div[data-role='content'] p#titlefield");$(h).html("Select a stop along "+g.title+":");this.service.getStops(i,{result:this.handleStopsResult,fault:this.handleStopsFault})}else{$.mobile.changePage("#home")}};a.prototype._hide=function(){this.emptyList();var g=this.page.find("div[data-role='content'] p#titlefield");$(g).html("")};var d=function(h,g){var i=this;this.handlePredictionsResult=function(k){if(k===null||k.length===0){$("#readOnlyTitleItemRenderer").tmpl({title:"No predictions found. Please try again at a later time."}).appendTo($("#predictions"))}else{$.each(k,function(l,m){var n=j(m);$("#readOnlyTitleItemRenderer").tmpl({title:n}).appendTo($("#predictions"))})}$("#predictions").listview("refresh");$.fixedToolbars.show(true);$.mobile.pageLoading(true)};this.handlePredictionsFault=function(k){$.mobile.pageLoading(true)};this.handleRefresh=function(k){$.mobile.pageLoading();k.preventDefault();i.emptyList();i.service.getPredictions(i.page.data("stop"),{result:i.handlePredictionsResult,fault:i.handlePredictionsFault});return false};this.emptyList=function(){$("#predictions").empty()};function j(n){var l,m,k,o;l=Math.round(n.seconds%60);m=Math.floor((n.seconds/60)%60);k=Math.floor(n.seconds/3600);o="";if(k>0){o+=k.toString()+" hour"+((k>1)?"s":"")}if(m>0){if(o.length>0){o+=" "}o+=m.toString()+" minute"+((m>1)?"s":"")}if(l>1){if(o.length>0){o+=" "}o+=l.toString()+" seconds"}return o}i._init(h,g)};d.prototype=new f();d.prototype._show=function(){var i=this.page.data("stop");if(i){$.mobile.pageLoading();var h=this.service.getStopById(i);var g=this.page.find("div[data-role='content'] p#titlefield");$(g).html("Next arrival times for "+h.title+":");this.service.getPredictions(i,{result:this.handlePredictionsResult,fault:this.handlePredictionsFault});this.page.find("#refreshbutton").bind("click",this.handleRefresh)}else{$.mobile.changePage("#home")}};d.prototype._hide=function(){this.emptyList();this.page.find("#refreshbutton").unbind("click",this.handleRefresh);var g=this.page.find("div[data-role='content'] p#titlefield");$(g).html("")};c.MassRouteController=f;c.RouteListController=b;c.DestinationListController=e;c.StopListController=a;c.PredictionListController=d;new b($("#home"),$.massroute);new e($("#destination"),$.massroute);new a($("#stop"),$.massroute);new d($("#prediction"),$.massroute)})(window);